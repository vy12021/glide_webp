apply plugin: 'com.android.library'

dependencies {
    implementation "com.android.support:support-annotations:${ANDROID_SUPPORT_VERSION}"

    testImplementation project(':testutil')
    testImplementation "com.android.support:support-v4:${ANDROID_SUPPORT_VERSION}"
    testImplementation "com.google.truth:truth:${TRUTH_VERSION}"
    testImplementation "junit:junit:${JUNIT_VERSION}"
    testImplementation "org.mockito:mockito-core:${MOCKITO_VERSION}"
    testImplementation "org.robolectric:robolectric:${ROBOLECTRIC_VERSION}"
}

android {
    compileSdkVersion COMPILE_SDK_VERSION as int

    defaultConfig {
        minSdkVersion MIN_SDK_VERSION as int
        targetSdkVersion TARGET_SDK_VERSION as int

        // This block is different from the one you use to link Gradle
        // to your CMake build script.
        externalNativeBuild {
            cmake {
                // targets "heifjni"
                abiFilters = ["armeabi-v7a"/*, "arm64-v8a", "x86"*/]
                // Use the following syntax when passing arguments to variables:
                // arguments "-DVAR_NAME=ARGUMENT".
                arguments "-DANDROID_ARM_NEON=TRUE",
                        "-DANDROID_TOOLCHAIN=clang",            // 编译器
                        "-DANDROID_STL=c++_shared",
                        "-DANDROID_PLATFORM=android-19",        // 编译目标系统版本
                        "-DANDROID_NATIVE_API_LEVEL=19",        // native api 级别
                        // "-DANDROID_STL=gnustl_static",          // stl库类型
                        "-DLIBCXX_FORCE_REBUILD=TRUE",          // llvm libc++库类型
                        // "-G=Android Gradle - Ninja",         // cmake指定构建系统
                        // "-DANDROID_NDK=",                    // NDK根目录
                        // "-DCMAKE_LIBRARY_OUTPUT_DIRECTORY=", // cmake输出结果lib目录
                        "-DCMAKE_BUILD_TYPE=Release",             // 编译构建方式Release
                        // "-DCMAKE_MAKE_PROGRAM=ninja",        // cmake指定make程序
                        // "-DCMAKE_TOOLCHAIN_FILE=path",       // cmake编译链工具地址,默认指向android.toolchain.cmake= $NDK/build/cmake/
                        "-DANDROID_CPP_FEATURES=rtti exceptions"    // c++特性
            }
        }
    }

    buildTypes {
        debug {
            debuggable true
            jniDebuggable true
        }
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    sourceSets {
        main {
            jniLibs.srcDirs = ['libs', 'src/main/cpp/output']
            jni.srcDirs = ['src/main/cpp']
        }
    }

    aaptOptions {
        cruncherEnabled = false
    }

    lintOptions {
        abortOnError false
    }

    testOptions {
        unitTests.returnDefaultValues = true
    }

    externalNativeBuild {
        cmake {
            path 'src/main/cpp/CMakeLists.txt'
        }
    }
}

apply from: "${rootProject.projectDir}/scripts/upload.gradle"
